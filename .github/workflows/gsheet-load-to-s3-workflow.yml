name: Descargar archivo de Google Drive y almacenarlo en AWS S3 Bucket

on:
  push:
    branches:
      - main

jobs:
  download:
    runs-on: ubuntu-20.04

    steps:
    - name: Checkout cÃ³digo fuente
      uses: actions/checkout@v4

    - name: Descarga de dependencias de Python
      run: |
        pip install -r requirements.txt
        pwd
        ls -a

    - name: Descarga de archivo Excel mediante Google Drive API
      env:
        CREDENTIALS_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
        REPOSITORY_NAME: ${{ vars.REPOSITORY_NAME }}
      run: |
        echo "$CREDENTIALS_JSON" > /home/runner/work/${{ vars.REPOSITORY_NAME }}/${{ vars.REPOSITORY_NAME }}/service_account_credentials.json
        pwd
        ls -a
        python download_file.py

    - id: install-aws-cli
      uses: unfor19/install-aws-cli-action@v1
      with:
        version: 2
        verbose: false
        arch: amd64
        rootdir: ""
        workdir: ""

    - name: Configurar credenciales de AWS
      run: |
        aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws configure set aws_session_token ${{ secrets.AWS_SESSION_TOKEN }}
        aws configure set default.region us-east-1

    - name: Subir archivo a S3
      run: |
        aws s3 cp employees-data-raw.xlsx s3://bucket-prueba-tdg-kmrc-jnpp/
